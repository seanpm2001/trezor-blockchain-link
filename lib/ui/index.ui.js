"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

require("worker-loader?name=js/blockbook-worker.ts!../workers/blockbook/index");

require("worker-loader?name=js/ripple-worker.ts!../workers/ripple/index");

var _config = _interopRequireDefault(require("./config"));

var _index3 = _interopRequireDefault(require("../index"));

var _this = void 0;

var handleClick = function handleClick(event) {
  var target = event.target;
  if (target.nodeName.toLowerCase() !== 'button') return;
  var network = getInputValue('network-type'); // const blockchain: Blockchain<Ripple> = BlockchainLink.get('Ripple Testnet');

  var blockchain = instances.find(function (b) {
    return b.settings.name === network;
  });
  if (!blockchain) return;
  var parentContainer = target.parentElement;
  var onResponse = handleResponse.bind(_this, parentContainer);
  var onError = handleError.bind(_this, parentContainer);

  switch (target.id) {
    case 'disconnect':
      blockchain.disconnect().then(onResponse).catch(onError);
      break;

    case 'get-info':
      blockchain.getInfo().then(onResponse).catch(onError);
      break;

    case 'get-account-info':
      {
        var payload = {
          descriptor: getInputValue('get-account-info-address'),
          details: getInputValue('get-account-info-mode') || 'basic',
          pageSize: getInputValue('get-account-info-pageSize') || 25,
          tokens: getInputValue('get-account-info-tokens') || 'derived',
          page: parseInt(getInputValue('get-account-info-page'), 2) || 10,
          from: parseInt(getInputValue('get-account-info-from'), 2),
          to: parseInt(getInputValue('get-account-info-to'), 2),
          contractFilter: getInputValue('get-account-info-contract') || ''
        };
        blockchain.getAccountInfo(payload).then(onResponse).catch(onError);
        break;
      }

    case 'estimate-fee':
      blockchain.estimateFee().then(onResponse).catch(onError);
      break;

    case 'push-transaction':
      blockchain.pushTransaction(getInputValue('push-transaction-tx')).then(onResponse).catch(onError);
      break;

    case 'subscribe-block':
      blockchain.subscribe({
        type: 'block'
      }).catch(onError);
      break;

    case 'unsubscribe-block':
      blockchain.unsubscribe({
        type: 'block'
      }).catch(onError);
      break;

    case 'subscribe-address':
      blockchain.subscribe({
        type: 'notification',
        addresses: getInputValue('subscribe-addresses').split(",")
      }).catch(onError);
      break;

    case 'unsubscribe-address':
      blockchain.unsubscribe({
        type: 'notification',
        addresses: getInputValue('subscribe-addresses').split(",")
      }).catch(onError);
      break;

    default:
      break;
  }
};

var handleResponse = function handleResponse(parent, response) {
  return prepareResponse(parent, response);
};

var handleError = function handleError(parent, error) {
  return prepareResponse(parent, error.message, true);
};

var handleBlockEvent = function handleBlockEvent(blockchain, notification) {
  var network = getInputValue('network-type');
  if (blockchain.settings.name !== network) return;
  var parent = document.getElementById('notification-block');
  prepareResponse(parent, notification);
};

var handleNotificationEvent = function handleNotificationEvent(blockchain, notification) {
  var network = getInputValue('network-type');
  if (blockchain.settings.name !== network) return;
  var parent = document.getElementById('notification-address');
  prepareResponse(parent, notification);
};

var handleConnectionEvent = function handleConnectionEvent(blockchain, status) {
  var parent = document.getElementById('notification-status');
  prepareResponse(parent, {
    blockchain: blockchain.settings.name,
    connected: status
  }, !status);
};

var handleErrorEvent = function handleErrorEvent(blockchain, message) {
  var parent = document.getElementById('notification-status');
  prepareResponse(parent, message, true);
};

var prepareResponse = function prepareResponse(parent, response) {
  var isError = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
  var div = document.createElement('pre');
  div.className = isError ? 'response error' : 'response';
  var close = document.createElement('div');
  close.className = 'close';

  close.onclick = function () {
    if (div.parentElement) div.parentElement.removeChild(div);
  };

  div.append(close);
  var pre = document.createElement('pre');
  pre.innerHTML = JSON.stringify(response, null, 2);
  div.appendChild(pre);
  var otherResponses = parent.getElementsByClassName('response');

  if (otherResponses.length > 0) {
    if (otherResponses.length >= 3) {
      parent.removeChild(otherResponses[2]);
    }

    parent.insertBefore(div, otherResponses[0]);
  } else {
    parent.appendChild(div);
  }
}; // utils


var onClear = function onClear() {
  var responses = document.getElementsByClassName('response');

  while (responses.length) {
    var r = responses[0];
    if (r.parentElement) r.parentElement.removeChild(r);
  }
};

var getInputValue = function getInputValue(id) {
  var value = document.getElementById(id).value;
  return value;
};

var setInputValue = function setInputValue(id, value) {
  var element = document.getElementById(id);
  element.value = value;
};

var onSelectChange = function onSelectChange(event) {
  var value = event.target.value;

  var b = _config.default.find(function (i) {
    return i.blockchain.name === value;
  });

  fillValues(b.data);
  onClear();
};

var onAccountInfoModeChange = function onAccountInfoModeChange(event) {
  var advanced = document.getElementById('get-account-info-advanced');
  advanced.style.display = event.target.value === 'advanced' ? 'block' : 'none';
};

var onEstimateFeeModeChange = function onEstimateFeeModeChange(event) {
  var advanced = document.getElementById('estimate-fee-advanced');
  advanced.style.display = event.target.value === 'advanced' ? 'block' : 'none';
};

var fillValues = function fillValues(data) {
  setInputValue('get-account-info-address', data.address);
  setInputValue('get-account-info-options', JSON.stringify(data.accountInfoOptions, null, 2));
  setInputValue('estimate-fee-options', JSON.stringify(data.estimateFeeOptions, null, 2));
  setInputValue('push-transaction-tx', data.tx);
  setInputValue('subscribe-addresses', data.subscribe);
};

var init = function init(instances) {
  var select = document.getElementById('network-type');
  select.innerHTML = instances.map(function (i) {
    var b = i.blockchain;

    if (i.selected) {
      fillValues(i.data);
      return "<option value=\"".concat(b.name, "\" selected>").concat(b.name, "</option>");
    } else {
      return "<option value=\"".concat(b.name, "\">").concat(b.name, "</option>");
    }
  });
  select.onchange = onSelectChange;
  var clear = document.getElementById('clear');
  clear.onclick = onClear;
  var accountInfoMode = document.getElementById('get-account-info-mode');
  accountInfoMode.onchange = onAccountInfoModeChange;
  var estimateFeeMode = document.getElementById('estimate-fee-mode');
  estimateFeeMode.onchange = onEstimateFeeModeChange;
};

init(_config.default);
var instances = [];

_config.default.forEach(function (i) {
  var b = new _index3.default(i.blockchain);
  b.on('connected', handleConnectionEvent.bind(_this, b, true));
  b.on('disconnected', handleConnectionEvent.bind(_this, b, false));
  b.on('error', handleErrorEvent.bind(_this, b, false));
  b.on('block', handleBlockEvent.bind(_this, b));
  b.on('notification', handleNotificationEvent.bind(_this, b));
  instances.push(b);
});

document.addEventListener('click', handleClick);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91aS9pbmRleC51aS50cyJdLCJuYW1lcyI6WyJoYW5kbGVDbGljayIsImV2ZW50IiwidGFyZ2V0Iiwibm9kZU5hbWUiLCJ0b0xvd2VyQ2FzZSIsIm5ldHdvcmsiLCJnZXRJbnB1dFZhbHVlIiwiYmxvY2tjaGFpbiIsImluc3RhbmNlcyIsImZpbmQiLCJiIiwic2V0dGluZ3MiLCJuYW1lIiwicGFyZW50Q29udGFpbmVyIiwicGFyZW50RWxlbWVudCIsIm9uUmVzcG9uc2UiLCJoYW5kbGVSZXNwb25zZSIsImJpbmQiLCJvbkVycm9yIiwiaGFuZGxlRXJyb3IiLCJpZCIsImRpc2Nvbm5lY3QiLCJ0aGVuIiwiY2F0Y2giLCJnZXRJbmZvIiwicGF5bG9hZCIsImRlc2NyaXB0b3IiLCJkZXRhaWxzIiwicGFnZVNpemUiLCJ0b2tlbnMiLCJwYWdlIiwicGFyc2VJbnQiLCJmcm9tIiwidG8iLCJjb250cmFjdEZpbHRlciIsImdldEFjY291bnRJbmZvIiwiZXN0aW1hdGVGZWUiLCJwdXNoVHJhbnNhY3Rpb24iLCJzdWJzY3JpYmUiLCJ0eXBlIiwidW5zdWJzY3JpYmUiLCJhZGRyZXNzZXMiLCJzcGxpdCIsInBhcmVudCIsInJlc3BvbnNlIiwicHJlcGFyZVJlc3BvbnNlIiwiZXJyb3IiLCJtZXNzYWdlIiwiaGFuZGxlQmxvY2tFdmVudCIsIm5vdGlmaWNhdGlvbiIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJoYW5kbGVOb3RpZmljYXRpb25FdmVudCIsImhhbmRsZUNvbm5lY3Rpb25FdmVudCIsInN0YXR1cyIsImNvbm5lY3RlZCIsImhhbmRsZUVycm9yRXZlbnQiLCJpc0Vycm9yIiwiZGl2IiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTmFtZSIsImNsb3NlIiwib25jbGljayIsInJlbW92ZUNoaWxkIiwiYXBwZW5kIiwicHJlIiwiaW5uZXJIVE1MIiwiSlNPTiIsInN0cmluZ2lmeSIsImFwcGVuZENoaWxkIiwib3RoZXJSZXNwb25zZXMiLCJnZXRFbGVtZW50c0J5Q2xhc3NOYW1lIiwibGVuZ3RoIiwiaW5zZXJ0QmVmb3JlIiwib25DbGVhciIsInJlc3BvbnNlcyIsInIiLCJ2YWx1ZSIsInNldElucHV0VmFsdWUiLCJlbGVtZW50Iiwib25TZWxlY3RDaGFuZ2UiLCJDT05GSUciLCJpIiwiZmlsbFZhbHVlcyIsImRhdGEiLCJvbkFjY291bnRJbmZvTW9kZUNoYW5nZSIsImFkdmFuY2VkIiwic3R5bGUiLCJkaXNwbGF5Iiwib25Fc3RpbWF0ZUZlZU1vZGVDaGFuZ2UiLCJhZGRyZXNzIiwiYWNjb3VudEluZm9PcHRpb25zIiwiZXN0aW1hdGVGZWVPcHRpb25zIiwidHgiLCJpbml0Iiwic2VsZWN0IiwibWFwIiwic2VsZWN0ZWQiLCJvbmNoYW5nZSIsImNsZWFyIiwiYWNjb3VudEluZm9Nb2RlIiwiZXN0aW1hdGVGZWVNb2RlIiwiZm9yRWFjaCIsIkJsb2NrY2hhaW5MaW5rIiwib24iLCJwdXNoIiwiYWRkRXZlbnRMaXN0ZW5lciJdLCJtYXBwaW5ncyI6Ijs7OztBQUNBOztBQUNBOztBQUVBOztBQUNBOzs7O0FBRUEsSUFBTUEsV0FBVyxHQUFHLFNBQWRBLFdBQWMsQ0FBQ0MsS0FBRCxFQUF1QjtBQUN2QyxNQUFNQyxNQUFtQixHQUFJRCxLQUFLLENBQUNDLE1BQW5DO0FBQ0EsTUFBSUEsTUFBTSxDQUFDQyxRQUFQLENBQWdCQyxXQUFoQixPQUFrQyxRQUF0QyxFQUFnRDtBQUNoRCxNQUFNQyxPQUFlLEdBQUdDLGFBQWEsQ0FBQyxjQUFELENBQXJDLENBSHVDLENBS3ZDOztBQUNBLE1BQU1DLFVBQVUsR0FBR0MsU0FBUyxDQUFDQyxJQUFWLENBQWUsVUFBQUMsQ0FBQztBQUFBLFdBQUlBLENBQUMsQ0FBQ0MsUUFBRixDQUFXQyxJQUFYLEtBQW9CUCxPQUF4QjtBQUFBLEdBQWhCLENBQW5CO0FBQ0EsTUFBSSxDQUFDRSxVQUFMLEVBQWlCO0FBRWpCLE1BQU1NLGVBQWUsR0FBR1gsTUFBTSxDQUFDWSxhQUEvQjtBQUNBLE1BQU1DLFVBQVUsR0FBR0Ms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cUJBQXFCLENBQUNwQyxJQUF0QixDQUEyQixLQUEzQixFQUFpQ1AsQ0FBakMsRUFBb0MsS0FBcEMsQ0FBckI7QUFDQUEsRUFBQUEsQ0FBQyxDQUFDOEYsRUFBRixDQUFLLE9BQUwsRUFBY2hELGdCQUFnQixDQUFDdkMsSUFBakIsQ0FBc0IsS0FBdEIsRUFBNEJQLENBQTVCLEVBQStCLEtBQS9CLENBQWQ7QUFDQUEsRUFBQUEsQ0FBQyxDQUFDOEYsRUFBRixDQUFLLE9BQUwsRUFBY3hELGdCQUFnQixDQUFDL0IsSUFBakIsQ0FBc0IsS0FBdEIsRUFBNEJQLENBQTVCLENBQWQ7QUFDQUEsRUFBQUEsQ0FBQyxDQUFDOEYsRUFBRixDQUFLLGNBQUwsRUFBcUJwRCx1QkFBdUIsQ0FBQ25DLElBQXhCLENBQTZCLEtBQTdCLEVBQW1DUCxDQUFuQyxDQUFyQjtBQUNBRixFQUFBQSxTQUFTLENBQUNpRyxJQUFWLENBQWUvRixDQUFmO0FBQ0gsQ0FSRDs7QUFVQXdDLFFBQVEsQ0FBQ3dELGdCQUFULENBQTBCLE9BQTFCLEVBQW1DMUcsV0FBbkMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBQcmVsb2FkIHdvcmtlcnMgaW4gd2VicGFjaywgZm9yY2Ugd2VicGFjayB0byBjb21waWxlIHRoZW1cbmltcG9ydCAnd29ya2VyLWxvYWRlcj9uYW1lPWpzL2Jsb2NrYm9vay13b3JrZXIudHMhLi4vd29ya2Vycy9ibG9ja2Jvb2svaW5kZXgnO1xuaW1wb3J0ICd3b3JrZXItbG9hZGVyP25hbWU9anMvcmlwcGxlLXdvcmtlci50cyEuLi93b3JrZXJzL3JpcHBsZS9pbmRleCc7XG5cbmltcG9ydCBDT05GSUcgZnJvbSAnLi9jb25maWcnO1xuaW1wb3J0IEJsb2NrY2hhaW5MaW5rIGZyb20gJy4uL2luZGV4JztcblxuY29uc3QgaGFuZGxlQ2xpY2sgPSAoZXZlbnQ6IE1vdXNlRXZlbnQpID0+IHtcbiAgICBjb25zdCB0YXJnZXQ6IEhUTUxFbGVtZW50ID0gKGV2ZW50LnRhcmdldCk7XG4gICAgaWYgKHRhcmdldC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpICE9PSAnYnV0dG9uJykgcmV0dXJuO1xuICAgIGNvbnN0IG5ldHdvcms6IHN0cmluZyA9IGdldElucHV0VmFsdWUoJ25ldHdvcmstdHlwZScpO1xuXG4gICAgLy8gY29uc3QgYmxvY2tjaGFpbjogQmxvY2tjaGFpbjxSaXBwbGU+ID0gQmxvY2tjaGFpbkxpbmsuZ2V0KCdSaXBwbGUgVGVzdG5ldCcpO1xuICAgIGNvbnN0IGJsb2NrY2hhaW4gPSBpbnN0YW5jZXMuZmluZChiID0+IGIuc2V0dGluZ3MubmFtZSA9PT0gbmV0d29yayk7XG4gICAgaWYgKCFibG9ja2NoYWluKSByZXR1cm47XG4gICAgXG4gICAgY29uc3QgcGFyZW50Q29udGFpbmVyID0gdGFyZ2V0LnBhcmVudEVsZW1lbnQ7XG4gICAgY29uc3Qgb25SZXNwb25zZSA9IGhhbmRsZVJlc3BvbnNlLmJpbmQodGhpcywgcGFyZW50Q29udGFpbmVyKTtcbiAgICBjb25zdCBvbkVycm9yID0gaGFuZGxlRXJyb3IuYmluZCh0aGlzLCBwYXJlbnRDb250YWluZXIpO1xuXG4gICAgc3dpdGNoICh0YXJnZXQuaWQpIHtcbiAgICAgICAgY2FzZSAnZGlzY29ubmVjdCc6XG4gICAgICAgICAgICBibG9ja2NoYWluLmRpc2Nvbm5lY3QoKS50aGVuKG9uUmVzcG9uc2UpLmNhdGNoKG9uRXJyb3IpO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgY2FzZSAnZ2V0LWluZm8nOlxuICAgICAgICAgICAgYmxvY2tjaGFpbi5nZXRJbmZvKCkudGhlbihvblJlc3BvbnNlKS5jYXRjaChvbkVycm9yKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBcbiAgICAgICAgY2FzZSAnZ2V0LWFjY291bnQtaW5mbyc6IHtcbiAgICAgICAgICAgIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgICAgICAgICAgICAgZGVzY3JpcHRvcjogZ2V0SW5wdXRWYWx1ZSgnZ2V0LWFjY291bnQtaW5mby1hZGRyZXNzJyksXG4gICAgICAgICAgICAgICAgZGV0YWlsczogZ2V0SW5wdXRWYWx1ZSgnZ2V0LWFjY291bnQtaW5mby1tb2RlJykgfHwgJ2Jhc2ljJyxcbiAgICAgICAgICAgICAgICBwYWdlU2l6ZTogZ2V0SW5wdXRWYWx1ZSgnZ2V0LWFjY291bnQtaW5mby1wYWdlU2l6ZScpIHx8IDI1LFxuICAgICAgICAgICAgICAgIHRva2VuczogZ2V0SW5wdXRWYWx1ZSgnZ2V0LWFjY291bnQtaW5mby10b2tlbnMnKSB8fCdkZXJpdmVkJyxcbiAgICAgICAgICAgICAgICBwYWdlOiBwYXJzZUludChnZXRJbnB1dFZhbHVlKCdnZXQtYWNjb3VudC1pbmZvLXBhZ2UnKSwgMikgfHwgMTAsXG4gICAgICAgICAgICAgICAgZnJvbTogcGFyc2VJbnQoZ2V0SW5wdXRWYWx1ZSgnZ2V0LWFjY291bnQtaW5mby1mcm9tJyksIDIpICxcbiAgICAgICAgICAgICAgICB0bzogcGFyc2VJbnQoZ2V0SW5wdXRWYWx1ZSgnZ2V0LWFjY291bnQtaW5mby10bycpLCAyKSAsXG4gICAgICAgICAgICAgICAgY29udHJhY3RGaWx0ZXI6IGdldElucHV0VmFsdWUoJ2dldC1hY2NvdW50LWluZm8tY29udHJhY3QnKSB8fCAnJyxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBibG9ja2NoYWluLmdldEFjY291bnRJbmZvKHBheWxvYWQpLnRoZW4ob25SZXNwb25zZSkuY2F0Y2gob25FcnJvcik7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIGNhc2UgJ2VzdGltYXRlLWZlZSc6XG4gICAgICAgICAgICBibG9ja2NoYWluLmVzdGltYXRlRmVlKCkudGhlbihvblJlc3BvbnNlKS5jYXRjaChvbkVycm9yKTtcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGNhc2UgJ3B1c2gtdHJhbnNhY3Rpb24nOlxuICAgICAgICAgICAgYmxvY2tjaGFpbi5wdXNoVHJhbnNhY3Rpb24oZ2V0SW5wdXRWYWx1ZSgncHVzaC10cmFuc2FjdGlvbi10eCcpKS50aGVuKG9uUmVzcG9uc2UpLmNhdGNoKG9uRXJyb3IpO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgY2FzZSAnc3Vic2NyaWJlLWJsb2NrJzpcbiAgICAgICAgICAgIGJsb2NrY2hhaW4uc3Vic2NyaWJlKHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnYmxvY2snXG4gICAgICAgICAgICB9KS5jYXRjaChvbkVycm9yKTtcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGNhc2UgJ3Vuc3Vic2NyaWJlLWJsb2NrJzpcbiAgICAgICAgICAgIGJsb2NrY2hhaW4udW5zdWJzY3JpYmUoe1xuICAgICAgICAgICAgICAgIHR5cGU6ICdibG9jaydcbiAgICAgICAgICAgIH0pLmNhdGNoKG9uRXJyb3IpO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgY2FzZSAnc3Vic2NyaWJlLWFkZHJlc3MnOlxuICAgICAgICAgICAgYmxvY2tjaGFpbi5zdWJzY3JpYmUoe1xuICAgICAgICAgICAgICAgIHR5cGU6ICdub3RpZmljYXRpb24nLFxuICAgICAgICAgICAgICAgIGFkZHJlc3NlczogZ2V0SW5wdXRWYWx1ZSgnc3Vic2NyaWJlLWFkZHJlc3NlcycpLnNwbGl0KFwiLFwiKSxcbiAgICAgICAgICAgIH0pLmNhdGNoKG9uRXJyb3IpO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgY2FzZSAndW5zdWJzY3JpYmUtYWRkcmVzcyc6XG4gICAgICAgICAgICBibG9ja2NoYWluLnVuc3Vic2NyaWJlKHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnbm90aWZpY2F0aW9uJyxcbiAgICAgICAgICAgICAgICBhZGRyZXNzZXM6IGdldElucHV0VmFsdWUoJ3N1YnNjcmliZS1hZGRyZXNzZXMnKS5zcGxpdChcIixcIiksXG4gICAgICAgICAgICB9KS5jYXRjaChvbkVycm9yKTtcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGRlZmF1bHQ6IGJyZWFrO1xuICAgIH1cbn1cblxuY29uc3QgaGFuZGxlUmVzcG9uc2UgPSAocGFyZW50OiBhbnksIHJlc3BvbnNlOiBhbnkpID0+IHByZXBhcmVSZXNwb25zZShwYXJlbnQsIHJlc3BvbnNlKTtcblxuY29uc3QgaGFuZGxlRXJyb3IgPSAocGFyZW50OiBhbnksIGVycm9yOiBhbnkpID0+IHByZXBhcmVSZXNwb25zZShwYXJlbnQsIGVycm9yLm1lc3NhZ2UsIHRydWUpO1xuXG5jb25zdCBoYW5kbGVCbG9ja0V2ZW50ID0gKGJsb2NrY2hhaW46IEJsb2NrY2hhaW5MaW5rLCBub3RpZmljYXRpb246IGFueSk6IHZvaWQgPT4ge1xuICAgIGNvbnN0IG5ldHdvcms6IHN0cmluZyA9IGdldElucHV0VmFsdWUoJ25ldHdvcmstdHlwZScpO1xuICAgIGlmIChibG9ja2NoYWluLnNldHRpbmdzLm5hbWUgIT09IG5ldHdvcmspIHJldHVybjtcbiAgICBjb25zdCBwYXJlbnQgPSAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25vdGlmaWNhdGlvbi1ibG9jaycpKTtcbiAgICBwcmVwYXJlUmVzcG9uc2UocGFyZW50LCBub3RpZmljYXRpb24pO1xufVxuXG5jb25zdCBoYW5kbGVOb3RpZmljYXRpb25FdmVudCA9IChibG9ja2NoYWluOiBCbG9ja2NoYWluTGluaywgbm90aWZpY2F0aW9uOiBhbnkpID0+IHtcbiAgICBjb25zdCBuZXR3b3JrOiBzdHJpbmcgPSBnZXRJbnB1dFZhbHVlKCduZXR3b3JrLXR5cGUnKTtcbiAgICBpZiAoYmxvY2tjaGFpbi5zZXR0aW5ncy5uYW1lICE9PSBuZXR3b3JrKSByZXR1cm47XG5cbiAgICBjb25zdCBwYXJlbnQgPSAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25vdGlmaWNhdGlvbi1hZGRyZXNzJykpO1xuICAgIHByZXBhcmVSZXNwb25zZShwYXJlbnQsIG5vdGlmaWNhdGlvbik7XG59XG5cbmNvbnN0IGhhbmRsZUNvbm5lY3Rpb25FdmVudCA9IChibG9ja2NoYWluOiBCbG9ja2NoYWluTGluaywgc3RhdHVzOiBib29sZWFuKSA9PiB7XG4gICAgY29uc3QgcGFyZW50ID0gKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdub3RpZmljYXRpb24tc3RhdHVzJykpO1xuICAgIHByZXBhcmVSZXNwb25zZShwYXJlbnQsIHtcbiAgICAgICAgYmxvY2tjaGFpbjogYmxvY2tjaGFpbi5zZXR0aW5ncy5uYW1lLFxuICAgICAgICBjb25uZWN0ZWQ6IHN0YXR1cyxcbiAgICB9LCAhc3RhdHVzKTtcbn1cblxuY29uc3QgaGFuZGxlRXJyb3JFdmVudCA9IChibG9ja2NoYWluOiBCbG9ja2NoYWluTGluaywgbWVzc2FnZTogYW55KSA9PiB7XG4gICAgY29uc3QgcGFyZW50ID0gKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdub3RpZmljYXRpb24tc3RhdHVzJykpO1xuICAgIHByZXBhcmVSZXNwb25zZShwYXJlbnQsIG1lc3NhZ2UsIHRydWUpO1xufVxuXG5jb25zdCBwcmVwYXJlUmVzcG9uc2UgPSAocGFyZW50OiBIVE1MRWxlbWVudCwgcmVzcG9uc2UsIGlzRXJyb3I6IGJvb2xlYW4gPSBmYWxzZSkgPT4ge1xuICAgIGNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3ByZScpO1xuICAgIGRpdi5jbGFzc05hbWUgPSBpc0Vycm9yID8gJ3Jlc3BvbnNlIGVycm9yJyA6ICdyZXNwb25zZSc7XG4gICAgY29uc3QgY2xvc2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBjbG9zZS5jbGFzc05hbWUgPSAnY2xvc2UnO1xuICAgIGNsb3NlLm9uY2xpY2sgPSAoKSA9PiB7XG4gICAgICAgIGlmIChkaXYucGFyZW50RWxlbWVudCkgZGl2LnBhcmVudEVsZW1lbnQucmVtb3ZlQ2hpbGQoZGl2KTtcbiAgICB9XG4gICAgZGl2LmFwcGVuZChjbG9zZSk7XG4gICAgY29uc3QgcHJlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncHJlJyk7XG4gICAgcHJlLmlubmVySFRNTCA9IEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlLCBudWxsICwgMik7XG4gICAgZGl2LmFwcGVuZENoaWxkKHByZSk7XG5cbiAgICBjb25zdCBvdGhlclJlc3BvbnNlcyA9IHBhcmVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdyZXNwb25zZScpO1xuICAgIGlmIChvdGhlclJlc3BvbnNlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGlmIChvdGhlclJlc3BvbnNlcy5sZW5ndGggPj0gMykge1xuICAgICAgICAgICAgcGFyZW50LnJlbW92ZUNoaWxkKG90aGVyUmVzcG9uc2VzWzJdKTtcbiAgICAgICAgfVxuICAgICAgICBwYXJlbnQuaW5zZXJ0QmVmb3JlKGRpdiwgb3RoZXJSZXNwb25zZXNbMF0pO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHBhcmVudC5hcHBlbmRDaGlsZChkaXYpO1xuICAgIH1cbn1cblxuXG4vLyB1dGlsc1xuXG5jb25zdCBvbkNsZWFyID0gKCkgPT4ge1xuICAgIGNvbnN0IHJlc3BvbnNlcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3Jlc3BvbnNlJyk7XG4gICAgd2hpbGUgKHJlc3BvbnNlcy5sZW5ndGgpIHtcbiAgICAgICAgY29uc3QgciA9IHJlc3BvbnNlc1swXTtcbiAgICAgICAgaWYgKHIucGFyZW50RWxlbWVudCkgci5wYXJlbnRFbGVtZW50LnJlbW92ZUNoaWxkKHIpO1xuICAgIH1cbn1cblxuY29uc3QgZ2V0SW5wdXRWYWx1ZSA9IChpZDogc3RyaW5nKTogc3RyaW5nID0+IHtcbiAgICBjb25zdCB2YWx1ZTogc3RyaW5nID0gKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKSkudmFsdWU7XG4gICAgcmV0dXJuIHZhbHVlO1xufVxuXG5jb25zdCBzZXRJbnB1dFZhbHVlID0gKGlkOiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcpOiB2b2lkID0+IHtcbiAgICBjb25zdCBlbGVtZW50ID0gKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKSk7XG4gICAgZWxlbWVudC52YWx1ZSA9IHZhbHVlO1xufVxuXG5jb25zdCBvblNlbGVjdENoYW5nZSA9IChldmVudCkgPT4ge1xuICAgIGNvbnN0IHZhbHVlID0gZXZlbnQudGFyZ2V0LnZhbHVlO1xuICAgIGNvbnN0IGIgPSBDT05GSUcuZmluZChpID0+IGkuYmxvY2tjaGFpbi5uYW1lID09PSB2YWx1ZSk7XG4gICAgZmlsbFZhbHVlcyhiLmRhdGEpO1xuICAgIG9uQ2xlYXIoKTtcbn1cblxuY29uc3Qgb25BY2NvdW50SW5mb01vZGVDaGFuZ2UgPSAoZXZlbnQpID0+IHtcbiAgICBjb25zdCBhZHZhbmNlZCA9IChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2V0LWFjY291bnQtaW5mby1hZHZhbmNlZCcpKTtcbiAgICBhZHZhbmNlZC5zdHlsZS5kaXNwbGF5ID0gZXZlbnQudGFyZ2V0LnZhbHVlID09PSAnYWR2YW5jZWQnID8gJ2Jsb2NrJyA6ICdub25lJztcbn1cblxuY29uc3Qgb25Fc3RpbWF0ZUZlZU1vZGVDaGFuZ2UgPSAoZXZlbnQpID0+IHtcbiAgICBjb25zdCBhZHZhbmNlZCA9IChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZXN0aW1hdGUtZmVlLWFkdmFuY2VkJykpO1xuICAgIGFkdmFuY2VkLnN0eWxlLmRpc3BsYXkgPSBldmVudC50YXJnZXQudmFsdWUgPT09ICdhZHZhbmNlZCcgPyAnYmxvY2snIDogJ25vbmUnO1xufVxuXG5jb25zdCBmaWxsVmFsdWVzID0gKGRhdGEpID0+IHtcbiAgICBzZXRJbnB1dFZhbHVlKCdnZXQtYWNjb3VudC1pbmZvLWFkZHJlc3MnLCBkYXRhLmFkZHJlc3MpO1xuICAgIHNldElucHV0VmFsdWUoJ2dldC1hY2NvdW50LWluZm8tb3B0aW9ucycsIEpTT04uc3RyaW5naWZ5KGRhdGEuYWNjb3VudEluZm9PcHRpb25zLCBudWxsLCAyKSk7XG4gICAgc2V0SW5wdXRWYWx1ZSgnZXN0aW1hdGUtZmVlLW9wdGlvbnMnLCBKU09OLnN0cmluZ2lmeShkYXRhLmVzdGltYXRlRmVlT3B0aW9ucywgbnVsbCwgMikpO1xuICAgIHNldElucHV0VmFsdWUoJ3B1c2gtdHJhbnNhY3Rpb24tdHgnLCBkYXRhLnR4KTtcbiAgICBzZXRJbnB1dFZhbHVlKCdzdWJzY3JpYmUtYWRkcmVzc2VzJywgZGF0YS5zdWJzY3JpYmUpO1xufVxuXG5jb25zdCBpbml0ID0gKGluc3RhbmNlcykgPT4ge1xuICAgIGNvbnN0IHNlbGVjdCA9IChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmV0d29yay10eXBlJykpO1xuICAgIHNlbGVjdC5pbm5lckhUTUwgPSBpbnN0YW5jZXMubWFwKGkgPT4ge1xuICAgICAgICBjb25zdCBiID0gaS5ibG9ja2NoYWluO1xuICAgICAgICBpZiAoaS5zZWxlY3RlZCkge1xuICAgICAgICAgICAgZmlsbFZhbHVlcyhpLmRhdGEpO1xuICAgICAgICAgICAgcmV0dXJuIGA8b3B0aW9uIHZhbHVlPVwiJHtiLm5hbWV9XCIgc2VsZWN0ZWQ+JHtiLm5hbWV9PC9vcHRpb24+YDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBgPG9wdGlvbiB2YWx1ZT1cIiR7Yi5uYW1lfVwiPiR7Yi5uYW1lfTwvb3B0aW9uPmA7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBzZWxlY3Qub25jaGFuZ2UgPSBvblNlbGVjdENoYW5nZTtcblxuICAgIGNvbnN0IGNsZWFyID0gKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjbGVhcicpKTtcbiAgICBjbGVhci5vbmNsaWNrID0gb25DbGVhcjtcblxuICAgIGNvbnN0IGFjY291bnRJbmZvTW9kZSA9IChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2V0LWFjY291bnQtaW5mby1tb2RlJykpO1xuICAgIGFjY291bnRJbmZvTW9kZS5vbmNoYW5nZSA9IG9uQWNjb3VudEluZm9Nb2RlQ2hhbmdlO1xuXG4gICAgY29uc3QgZXN0aW1hdGVGZWVNb2RlID0gKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdlc3RpbWF0ZS1mZWUtbW9kZScpKTtcbiAgICBlc3RpbWF0ZUZlZU1vZGUub25jaGFuZ2UgPSBvbkVzdGltYXRlRmVlTW9kZUNoYW5nZTtcbn1cblxuaW5pdChDT05GSUcpO1xuXG5jb25zdCBpbnN0YW5jZXM6IEFycmF5PEJsb2NrY2hhaW5MaW5rPiA9IFtdO1xuQ09ORklHLmZvckVhY2goaSA9PiB7XG4gICAgY29uc3QgYiA9IG5ldyBCbG9ja2NoYWluTGluayhpLmJsb2NrY2hhaW4pO1xuICAgIGIub24oJ2Nvbm5lY3RlZCcsIGhhbmRsZUNvbm5lY3Rpb25FdmVudC5iaW5kKHRoaXMsIGIsIHRydWUpKTtcbiAgICBiLm9uKCdkaXNjb25uZWN0ZWQnLCBoYW5kbGVDb25uZWN0aW9uRXZlbnQuYmluZCh0aGlzLCBiLCBmYWxzZSkpO1xuICAgIGIub24oJ2Vycm9yJywgaGFuZGxlRXJyb3JFdmVudC5iaW5kKHRoaXMsIGIsIGZhbHNlKSk7XG4gICAgYi5vbignYmxvY2snLCBoYW5kbGVCbG9ja0V2ZW50LmJpbmQodGhpcywgYikpO1xuICAgIGIub24oJ25vdGlmaWNhdGlvbicsIGhhbmRsZU5vdGlmaWNhdGlvbkV2ZW50LmJpbmQodGhpcywgYikpO1xuICAgIGluc3RhbmNlcy5wdXNoKGIpO1xufSk7XG5cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlQ2xpY2spO1xuIl19